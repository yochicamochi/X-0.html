<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>XO – משחק איקס עיגול</title>
  <style>
    :root{
      --bg:#0f172a;         /* slate-900 */
      --panel:#111827;      /* gray-900 */
      --ink:#e5e7eb;        /* gray-200 */
      --muted:#94a3b8;      /* slate-400 */
      --accent:#22c55e;     /* green-500 */
      --accent-2:#3b82f6;   /* blue-500 */
      --danger:#ef4444;     /* red-500 */
      --shadow: 0 20px 40px rgba(0,0,0,.35);
      --radius: 20px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1000px 600px at 20% 0%, #1f2937 0%, #0b1223 40%, var(--bg) 100%);
      color:var(--ink); font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      display:grid; place-items:center; padding:24px;
    }
    .app{
      width:min(960px, 96vw);
      display:grid; gap:20px;
      grid-template-columns: 1fr minmax(260px, 280px);
      align-items:start;
    }
    @media (max-width: 820px){
      .app{grid-template-columns: 1fr}
    }
    .card{
      background: linear-gradient(180deg, #0b1020 0%, #0e1324 100%);
      border:1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:20px;
    }
    .title{display:flex; align-items:center; justify-content:space-between; gap:12px}
    h1{font-size:clamp(22px, 2.6vw, 34px); margin:0; letter-spacing:.5px}
    .sub{color:var(--muted); font-size:14px}

    /* Controls */
    .controls{display:flex; gap:12px; flex-wrap:wrap}
    .seg{
      background:#0a1223; border:1px solid rgba(255,255,255,.06);
      border-radius: 14px; padding:6px; display:inline-flex; gap:6px;
    }
    .seg button{
      border:0; padding:10px 14px; border-radius:10px; cursor:pointer;
      background:transparent; color:var(--ink); font-weight:600; letter-spacing:.2px
    }
    .seg button[aria-pressed="true"]{background:#13203c}
    .btn{
      border:1px solid rgba(255,255,255,.08); background:#111a30; color:var(--ink);
      padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:700
    }
    .btn:hover{filter:brightness(1.15)}

    /* Board */
    .board-wrap{display:grid; gap:14px}
    .status{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .status .turn{font-size:18px; font-weight:700}
    .grid{
      width:min(520px, 88vw);
      aspect-ratio:1/1; display:grid; grid-template-columns:repeat(3,1fr); gap:12px;
    }
    .cell{
      display:grid; place-items:center; border-radius:18px; cursor:pointer; user-select:none;
      background: linear-gradient(180deg, #0c1933 0%, #0a1428 100%);
      border:1px solid rgba(255,255,255,.06);
      transition: transform .08s ease, filter .15s ease, background .2s ease;
      font-weight:900; font-size: clamp(40px, 10vw, 90px);
      text-shadow: 0 6px 18px rgba(0,0,0,.35);
    }
    .cell:hover{transform: translateY(-2px)}
    .cell.x{color:var(--accent)}
    .cell.o{color:var(--accent-2)}
    .cell.win{outline:3px solid rgba(255,255,255,.12); box-shadow: 0 0 0 4px rgba(255,255,255,.04) inset}
    .grid[aria-busy="true"] .cell{pointer-events:none; filter: saturate(.7);}

    /* Sidebar */
    .side{display:grid; gap:16px}
    .score{
      display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; text-align:center
    }
    .pill{
      background:#0e1a31; border:1px solid rgba(255,255,255,.06);
      border-radius:14px; padding:12px; display:grid; gap:6px
    }
    .pill .k{font-size:12px; color:var(--muted)}
    .pill .v{font-size:26px; font-weight:900}

    .legend{display:flex; gap:10px}
    .dot{width:10px; height:10px; border-radius:999px}
    .dot.x{background:var(--accent)}
    .dot.o{background:var(--accent-2)}
    .dot.d{background:var(--muted)}

    .note{color:var(--muted); font-size:13px; line-height:1.6}
    .footer{color:#6b7280; font-size:12px; text-align:center; margin-top:8px}
    .link{color:#a5b4fc; text-decoration:none}
  </style>
</head>
<body>
  <div class="app">
    <section class="card">
      <div class="title">
        <h1>איקס–עיגול (X O)</h1>
        <div class="legend" aria-hidden="true">
          <span class="dot x" title="X"></span>
          <span class="dot o" title="O"></span>
          <span class="dot d" title="תיקו"></span>
        </div>
      </div>

      <div class="controls" aria-label="הגדרות משחק">
        <div class="seg" role="group" aria-label="מצב משחק">
          <button id="modePVP" aria-pressed="true">שני שחקנים</button>
          <button id="modeCPU" aria-pressed="false">נגד מחשב</button>
        </div>
        <button id="reset" class="btn" title="משחק חדש (R)">משחק חדש</button>
        <button id="resetScores" class="btn" title="איפוס ניקוד">איפוס ניקוד</button>
      </div>

      <div class="board-wrap">
        <div class="status">
          <div class="turn" id="turn">תור: <span id="turnPlayer">X</span></div>
          <div id="message" class="sub" role="status" aria-live="polite"></div>
        </div>
        <div id="grid" class="grid" role="grid" aria-busy="false" aria-label="לוח משחק">
          <!-- 9 cells injected by JS -->
        </div>
      </div>
      <div class="footer">נבנה ב־HTML, CSS ו־JavaScript – משחק רספונסיבי, נגיש ומהיר.</div>
    </section>

    <aside class="card side" aria-label="ניקוד והסברים">
      <div class="score">
        <div class="pill" aria-label="ניצחונות X">
          <div class="k">ניצחונות X</div>
          <div id="scoreX" class="v">0</div>
        </div>
        <div class="pill" aria-label="תיקו">
          <div class="k">תיקו</div>
          <div id="scoreD" class="v">0</div>
        </div>
        <div class="pill" aria-label="ניצחונות O">
          <div class="k">ניצחונות O</div>
          <div id="scoreO" class="v">0</div>
        </div>
      </div>
      <div class="note">
        <strong>טיפים:</strong>
        <ul>
          <li>במצב "נגד מחשב" אתה תמיד X, והמחשב משחק O.</li>
          <li>לחץ על <em>משחק חדש</em> כדי לשמור את הניקוד ולהתחיל סיבוב נוסף.</li>
          <li>קיצורי מקלדת: <kbd>R</kbd> – משחק חדש, <kbd>C</kbd> – החלפת מצב, <kbd>Esc</kbd> – איפוס ניקוד.</li>
        </ul>
      </div>
    </aside>
  </div>

  <script>
    const gridEl = document.getElementById('grid');
    const messageEl = document.getElementById('message');
    const turnEl = document.getElementById('turnPlayer');
    const scoreXEl = document.getElementById('scoreX');
    const scoreOEl = document.getElementById('scoreO');
    const scoreDEl = document.getElementById('scoreD');

    const btnReset = document.getElementById('reset');
    const btnResetScores = document.getElementById('resetScores');
    const btnModePVP = document.getElementById('modePVP');
    const btnModeCPU = document.getElementById('modeCPU');

    const wins = [
      [0,1,2],[3,4,5],[6,7,8], // rows
      [0,3,6],[1,4,7],[2,5,8], // cols
      [0,4,8],[2,4,6]          // diagonals
    ];

    const state = {
      board: Array(9).fill(''),
      player: 'X',
      active: true,
      mode: 'PVP', // PVP | CPU
      scores: { X: 0, O: 0, D: 0 }
    };

    function initBoard(){
      gridEl.innerHTML = '';
      for(let i=0;i<9;i++){
        const btn = document.createElement('button');
        btn.className = 'cell';
        btn.setAttribute('role','gridcell');
        btn.setAttribute('aria-label', `תא ${i+1}`);
        btn.dataset.idx = i;
        btn.addEventListener('click', onCellClick);
        gridEl.appendChild(btn);
      }
      render();
    }

    function onCellClick(e){
      const i = Number(e.currentTarget.dataset.idx);
      if(!state.active || state.board[i]) return;
      move(i, state.player);
      if(!state.active) return; // win/draw just happened

      if(state.mode === 'CPU' && state.player === 'O'){
        gridEl.setAttribute('aria-busy','true');
        setTimeout(()=>{
          const ai = bestMove('O');
          move(ai, 'O');
          gridEl.setAttribute('aria-busy','false');
        }, 220);
      }
    }

    function move(i, p){
      if(state.board[i]) return;
      state.board[i] = p;
      const res = check();
      if(res.win){
        state.active = false;
        highlight(res.line);
        messageEl.textContent = `ניצחון ל־${p}!`;
        state.scores[p]++; updateScores();
      } else if(res.draw){
        state.active = false;
        messageEl.textContent = 'תיקו!';
        state.scores.D++; updateScores();
      } else {
        state.player = p === 'X' ? 'O' : 'X';
        messageEl.textContent = '';
      }
      render();
    }

    function check(){
      const b = state.board;
      for(const line of wins){
        const [a,b1,c] = line;
        if(b[a] && b[a]===b[b1] && b[a]===b[c]) return {win:true, line};
      }
      const draw = b.every(Boolean);
      return {win:false, draw};
    }

    function highlight(line){
      [...gridEl.children].forEach((el,idx)=>{
        if(line.includes(idx)) el.classList.add('win');
      })
    }

    function render(){
      [...gridEl.children].forEach((el, idx)=>{
        const v = state.board[idx];
        el.textContent = v;
        el.classList.toggle('x', v==='X');
        el.classList.toggle('o', v==='O');
      });
      turnEl.textContent = state.player;
      gridEl.dataset.turn = state.player;
    }

    function updateScores(){
      scoreXEl.textContent = state.scores.X;
      scoreOEl.textContent = state.scores.O;
      scoreDEl.textContent = state.scores.D;
    }

    function resetGame(keepTurn=false){
      state.board = Array(9).fill('');
      state.active = true;
      if(!keepTurn) state.player = 'X';
      messageEl.textContent = '';
      [...gridEl.children].forEach(el=>el.classList.remove('win'));
      render();
      // If CPU and CPU starts? We keep human (X) first for simplicity
    }

    function resetScores(){
      state.scores = {X:0, O:0, D:0};
      updateScores();
      resetGame();
    }

    // --- Minimax AI (O is AI) ---
    function bestMove(ai){
      const human = ai === 'X' ? 'O' : 'X';

      function scoreBoard(b){
        for(const line of wins){
          const [i,j,k] = line;
          if(b[i] && b[i]===b[j] && b[i]===b[k]) return b[i]==='O' ? 10 : -10;
        }
        return 0;
      }

      function isMovesLeft(b){
        return b.some(c=>!c);
      }

      function minimax(b, depth, isMax){
        const s = scoreBoard(b);
        if(s===10) return s - depth;  // prefer faster win
        if(s===-10) return s + depth; // prefer slower loss
        if(!isMovesLeft(b)) return 0;

        if(isMax){ // AI turn (O)
          let best = -Infinity;
          for(let i=0;i<9;i++) if(!b[i]){
            b[i] = ai; // O
            best = Math.max(best, minimax(b, depth+1, false));
            b[i] = '';
          }
          return best;
        } else {  // human turn (X)
          let best = Infinity;
          for(let i=0;i<9;i++) if(!b[i]){
            b[i] = human; // X
            best = Math.min(best, minimax(b, depth+1, true));
            b[i] = '';
          }
          return best;
        }
      }

      let bestVal = -Infinity, bestIdx = -1;
      for(let i=0;i<9;i++) if(!state.board[i]){
        state.board[i] = ai;
        const moveVal = minimax(state.board, 0, false);
        state.board[i] = '';
        if(moveVal > bestVal){ bestVal = moveVal; bestIdx = i; }
      }
      return bestIdx !== -1 ? bestIdx : state.board.findIndex(c=>!c);
    }

    // Events
    btnReset.addEventListener('click', ()=> resetGame());
    btnResetScores.addEventListener('click', resetScores);

    function setMode(m){
      state.mode = m;
      btnModePVP.setAttribute('aria-pressed', m==='PVP');
      btnModeCPU.setAttribute('aria-pressed', m==='CPU');
      resetGame();
      messageEl.textContent = (m==='CPU') ? 'אתה משחק X מול מחשב בלתי מנוצח.' : 'מצב שני שחקנים הופעל.';
    }

    btnModePVP.addEventListener('click', ()=> setMode('PVP'));
    btnModeCPU.addEventListener('click', ()=> setMode('CPU'));

    // Keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if(e.key.toLowerCase()==='r') btnReset.click();
      if(e.key.toLowerCase()==='c') setMode(state.mode==='PVP'?'CPU':'PVP');
      if(e.key==='Escape') btnResetScores.click();
    });

    // Start
    initBoard();
  </script>
</body>
</html>
